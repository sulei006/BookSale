<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="_fragments :: head(~{::title})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑页面</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
    <link rel="stylesheet" href="../static/css/me.css">

</head>
<body>

<!--导航-->
<nav th:replace="_fragments :: menu(-1)" class="ui inverted segment m-padded-tb-mini m-shadow-small">
    <div class="ui container">
        <div class="ui inverted secondary stackable menu" >
            <h2 class="ui teal header item">图书销售管理系统</h2>

            <a href="#" class="m-item item m-mobile-hide"><i class="home icon "></i>书本库存</a>
            <a href="#" class="m-item item m-mobile-hide"><i class="idea icon"></i> 退货清单</a>
            <a href="#" class="m-item item m-mobile-hide"><i class="tags icon"></i> 进货清单</a>
            <a href="#" class="m-item item m-mobile-hide"><i class="info icon"></i> 供应商进货</a>


            <div class="right item ">
                <div class="ui icon inverted transparent input m-mobile-hide">
                    <!--            placeholder:表示灰色的输入文字-->
                    <input type="text" placeholder="Search....">
                    <i class="search  link icon"></i>
                </div>
            </div>
        </div>
    </div>
    <!--menu toggle只是用于获取该按钮-->
    <a href="#" class="ui black icon button m-right-top m-mobile-show menu toggle">
        <i class="sidebar icon"></i>
    </a>
</nav>



<!--数据输出-->
<div  type="hidden" class="m-container-small m-padded-tb-big">
    <div class="ui container">

        <table class="ui basic table">
            <thead>
            <tr>
                <th>图书名称</th>
                <th>进价</th>
                <th>售价</th>
                <th>库存数量</th>
                <th>售出数量</th>
            </tr>
            </thead>

            <tbody>
            <tr>
                <td align="centre" th:text="${book.bookName}">刻意练习清单</td>
                <td align="centre" th:text="${book.inPrice}">19.0</td>
                <td align="centre" th:text="${book.outPrice}">19.0</td>
                <td align="centre" th:text="${book.leftNum}">1</td>
                <td align="centre" th:text="${book.soldNum}">1</td>
            </tr>
            </tbody>

        </table>
        <div class="ui container">
            <div onclick="openForm1()" class="ui animated fade button teal" tabindex="0">
                <div class="visible content">修改售价</div>
                <div class="hidden content">-,- </div>
            </div>

            <div onclick="openForm2()" class="ui animated fade button red" tabindex="0">
                <div class="visible content">销售</div>
                <div class="hidden content">-,- </div>
            </div>

            <div onclick="openForm3()" class="ui animated fade button white" tabindex="0">
                <div class="visible content">退货</div>
                <div class="hidden content">-,- </div>
            </div>
        </div>
    </div>
</div>
<div id="form1" class="ui large modal">
    <i class="close icon"></i>
    <div class="header" th:text="${book.bookName}">
        用户信息
    </div>
    <div class=" content">

        <form action="#" th:action="@{/chaInpri/{id}(id=${book.bookId})}" method="post" class="ui form" onsubmit="return check1()">

            <div class="field">
                <label>售价：</label>
                <input type="text" th:value="${book.outPrice}" name="outPrice" placeholder="昵称">
            </div>

            <div class="actions">
                <div class="ui black deny button">
                    关闭
                </div>
                <button class="ui positive right labeled icon button">
                    提交
                    <i class="checkmark icon"></i>
                </button>
            </div>
        </form>
    </div>
</div>
<div id="form2" class="ui large modal">
    <i class="close icon"></i>
    <div class="header" th:text="${book.bookName}">
        用户信息
    </div>
    <div class=" content">

        <form action="#" th:action="@{/sale/{id}(id=${book.bookId})}" method="post" class="ui form" onsubmit="return check2()">

            <div class="field" type="hidden">
               <label >库存数量：</label>
                <div type="text" th:text="${book.leftNum}" name="leftNum" ></div>
            </div>

            <div class="field">
                <label>售出数量：</label>
                <input name="toSellNum" placeholder="请输入要售出的书本数目...">
            </div>

            <div class="actions">
                <div class="ui black deny button">
                    关闭
                </div>
                <button class="ui positive right labeled icon button">
                    提交
                    <i class="checkmark icon"></i>
                </button>
            </div>

        </form>

    </div>


</div>
<div id="form3" class="ui large modal">
    <i class="close icon"></i>
    <div class="header" th:text="${book.bookName}">
        用户信息
    </div>
    <div class=" content">

        <form action="#" th:action="@{/return/{id}(id=${book.bookId})}" method="post" class="ui form" onsubmit="return check3()">

            <div class="field" >
                <label>退货数量：</label>
                <input  name="returnNum" placeholder="请输入要退货的数量...">
            </div>


            <div class="actions">
                <div class="ui black deny button">
                    关闭
                </div>
                <button class="ui positive right labeled icon button">
                    提交
                    <i class="checkmark icon"></i>
                </button>
            </div>

        </form>

    </div>


</div>

<div id="errorMsg" class="ui negative modal message">
    <div type="text" class="header" id="msg">
    </div>
    <div class="content">请重新输入</div>
</div>
<br>
<br>
<!--底部footer-->
<footer th:replace="_fragments :: footer" class="ui inverted vertical segment m-padded-tb-massive">
    <div class="ui center aligned container">
        <div class="ui inverted divided stackable grid">
            <div class="three wide column">
                <div class="ui inverted link list">
                    <div class="item">
                        <img src="../static/images/book.jpg" class="ui rounded image" alt="" style="width: 110px">
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced " >操作介绍</h4>
                <div class="ui inverted link list">
                    <a href="#" class="item m-text-thin">后面再写</a>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">联系我们</h4>
                <div class="ui inverted link list">
                    <a href="#" class="item m-text-thin">Email：xxxxxxxx.com</a>
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header m-text-thin m-text-spaced ">技术支持</h4>
                <p class="m-text-thin m-text-spaced m-opacity-mini"><i>telephone:88888888</i></p>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <p class="m-text-thin m-text-spaced m-opacity-tiny"><i>Copyright @ 2020-2021 written for database system project</i></p>
    </div>

</footer>
<!--/*/<th:block th:replace="_fragments :: script">/*/-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
<!--/*/</th:block>/*/-->
<script>
    $('.menu.toggle').click(function () {
        $('.m-item').toggleClass('m-mobile-hide');
    });

    $('.ui.dropdown').dropdown({
        on : 'hover'
    });

    function openForm1()
    {
        $('#form1')
            .modal('show')
        ;
    };

    function openForm2()
    {
        $('#form2')
            .modal('show')
        ;
    };

    function openForm3()
    {
        $('#form3')
            .modal('show')
        ;
    };

    function check1()
    {
        var outPrice=$("[name='outPrice']").val();

        if(outPrice.replace(/(^s*)|(s*$)/g,"").length==0)
        {
            $('#errorMsg #msg').text("error:请输入售价！");
            $('#errorMsg').modal('show');
            return false;
        }

        else if(isNaN(outPrice)) {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }

        else if (outPrice<0)
        {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        return true;
    }

    function check2()
    {
        var leftS=$("[name='leftNum']").text();
        var left=parseInt(leftS);
        var sell=$("[name='toSellNum']").val();

        if(sell.replace(/(^s*)|(s*$)/g,"").length==0)
        {
            $('#errorMsg #msg').text("error:请输入售出书本数！");
            $('#errorMsg').modal('show');
            return false;
        }

        else if(isNaN(sell)) {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        else if(String(sell).indexOf(".")+1>0)
        {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        else if(sell>left) {
            $('#errorMsg #msg').text("error:库存量不足");
            $('#errorMsg').modal('show');
            return false
        }
        else if (sell<0)
        {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        return true;
    }
    function check3()
    {
        var returnNum=$("[name='returnNum']").val();

        if(returnNum.replace(/(^s*)|(s*$)/g,"").length==0)
        {
            $('#errorMsg #msg').text("error:请输入退货数量！");
            $('#errorMsg').modal('show');
            return false;
        }
        else if(isNaN(returnNum)) {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        else if(String(returnNum).indexOf(".")+1>0)
        {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        else if(returnNum<0)
        {
            $('#errorMsg #msg').text("error:输入不合法！");
            $('#errorMsg').modal('show');
            return false;
        }
        return true;
    }

</script>
</body>
</html>